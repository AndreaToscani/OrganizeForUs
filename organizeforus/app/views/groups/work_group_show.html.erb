<html>
<head>
  <%if !user_signed_in? %>
    <% controller.redirect_to new_user_session_path %>
  <%end%>
</head>
<body> 
<%= stylesheet_link_tag "application" %> 


  <!-- barra comandi-->
   <div class="row" style="width:100% ;text-align:right">
      <div class="col" style="width:80%"> 
      <h1 class="display-6" style="text-align:left"> <%= image_tag group_image(@group, 5000), :size => "60x60", class: "rounded-circle" %><%= @group.name %></h1>
      </div>    
      <div class="col" > 
      <div class="row" style=" text-align:right">
        <div class="col">
          <a href="<%= groups_path %>" style="color: black">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-90deg-left" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M1.146 4.854a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 4H12.5A2.5 2.5 0 0 1 15 6.5v8a.5.5 0 0 1-1 0v-8A1.5 1.5 0 0 0 12.5 5H2.707l3.147 3.146a.5.5 0 1 1-.708.708l-4-4z"/>
            </svg>
          </a>
        </div>
        
        <div class="col">
          <a href="<%= edit_group_path(@group) %>" title="Edit" style="color: black" id="EditGroup">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
            <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
            <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
          </svg>
          </a>
        </div>
        <!--
        <div class="col">
          <a href="<%= new_group_event_path(@group) %>" title="New event" style="color: black">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar-plus" viewBox="0 0 16 16">
            <path d="M8 7a.5.5 0 0 1 .5.5V9H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V10H6a.5.5 0 0 1 0-1h1.5V7.5A.5.5 0 0 1 8 7z"/>
            <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
            </svg>
          </a>
        </div>
        -->

        
        <div class="col">
          <button type="button" class="btn btn-sm" id="ButtonGroupDelete" title="Delete" onclick="show('box')"> 
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16">
              <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/>
            </svg>
          </button>
          <div class="alert alert-danger" role="alert" id="box" style="display:none" >Are you sure?
            <%= button_to 'Delete group', @group, class:"btn btn-danger btn-sm", method: :delete, id: "DestroyGroupWork" %>
          </div>
        </div>
        
      </div>
      </div>
    </div> 

    <div style="text-align: right">
    </div>
    <br>

 

  <div class="container" id="info_fun">
      <div class="row">
          <div class="col mb-2",  style="width:80%, margin-left:10px">
          <br>
          <h4 class="display-6"><%= @group.description %></h4>
            <h6 class="lead">Work group</h6>
          </div>

       

          <div class="col">     
          </div>
        </div>
    </div>

    

  </br>

  <!-- INIZIO ACCORDION -->
  <div class="container" style="width:100%">

  <div class="accordion" id="accordionExample">
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingOne">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
        Members
      </button>
    </h2>
    <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
      <div class="accordion-body">
        <%  i=0 %>
              <% if i<3 %>
                  <% @group.partecipations.each do |member| %>
                    <div class="row"> 
                      <% if @group.accepted?(member.user.id) %> 
                        <div class="col">
                          <li style="color: <%=member.role_color%>" >  
                            <span > <%= member.user.email %> </span> 
                          </li> 
                        </div>
                        <% i=i+1%>
                      <% end %>
                    </div>
                  <%end%>
              <% end %>
        <span><%= link_to "Show More",show_p_url(@group), class:"btn btn btn-sm" %></span>
      </div>
    </div>
  </div>
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingTwo">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
        Events
      </button>
    </h2>
    <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
      <div class="accordion-body">
      <% if !@group.events.empty? %>
        <% @group.events.each do |event|%>
          <li><%= event.title%> </li>
        <%end %>
      <%else%>
        <p class="lead">No events yet</p>
      <%end%>
      <span><%= link_to "Show More", group_events_path(@group), class:"btn btn btn-sm" %></span>
      </div>  
    </div>
  </div>
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingThree">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
        Surveys
      </button>
    </h2>
    <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
      <div class="accordion-body">
      <% if !@group.surveys.empty? %>
                <% i = 0 %> 
                  <% @group.surveys.active.take(3).each do |s| %>
                    <% if i < 3 && i <= @group.surveys.count %>
                      <%i=i+1%>
                        <%= link_to s.title , show_survey_path(@group,s) %>
                    <%end%>
                  <%end%>
              <%else%>
              <p class="lead">No surveys yet</p>
              <%end%>
      <span><%= link_to "Show More", index_survey_url(@group), class:"btn btn btn-sm" %></span>
      </div>
    </div>
  </div>
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingFour">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
        Posts
      </button>
    </h2>
    <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#accordionExample">
      <div class="accordion-body">
        <span><%= link_to "Show more", group_posts_url(@group), id:"Posts",  class:"btn btn btn-sm" %></span>
      </div>
    </div>
  </div>

<div class="accordion-item">
    <h2 class="accordion-header" id="headingFive">
      <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive" aria-expanded="false" aria-controls="collapseFive">
        Group's hours stats
      </button>
    </h2>
    <div id="collapseFive" class="accordion-collapse collapse" aria-labelledby="headingFive" data-bs-parent="#accordionExample">
      <div class="accordion-body">
<div class="row", style="align: center">
  <div class="col", style="align: left", id="grafico1">
   <%worked_hours=0%>
      <%extra_hours=0%>
      <%added_hours=0%>
      <% @group.events.each do |event| %>
        <%if event.type_of_hours=="To take from to Group's hours"%>
        <%worked_hours=worked_hours+(event.end_date-event.start_date)/3600%>
          <%if worked_hours>@group.hours%>
          <%rimanenza=worked_hours-@group.hours%>
           <%worked_hours=worked_hours-rimanenza%>
           <%extra_hours=extra_hours+rimanenza%>
          <%end%>
        <%elsif event.type_of_hours=="To add from Group's hours" %>
          <%added_hours=added_hours+(event.end_date-event.start_date)/3600%>
        <%end%>   
      <%end%>  
      </div>
      <%if added_hours==0 && extra_hours==0%>
         <div class="col", style="align: right; visibility: hidden", id="grafico2">
         </div>
      <%else%>
         <div class="col", style="align: right", id="grafico2">
         </div>
      <%end%>
    </div>
      </div>
    </div>
  </div>
</div>
  
</div>
  <!-- FINE ACCORDION -->
<br>
  <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-core.min.js"></script>
  <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-pie.min.js"></script>
  <script src="https://cdn.anychart.com/releases/8.11.0/js/anychart-exports.min.js"></script>
<script type="text/javascript">
anychart.onDocumentReady(function () {

    // create data
    var data = [

      {x: "Remaining hours", value: <%=@group.hours-worked_hours%>},
      {x: "Worked hours", value: <%=worked_hours%>},
    ];

    // create a chart and set the data
    var chart = anychart.pie();
    chart.data(data);
    // set the chart title
    chart.title("Group's scheduled hours stats");

    // set the container id
    chart.container("grafico1");

    // initiate drawing the chart
    chart.draw();
});

anychart.onDocumentReady(function () {

    // create data
    var data = [

      {x: "Added hours", value: <%=added_hours%>},
      {x: "Extra hours", value: <%=extra_hours%>},
    ];

    // create a chart and set the data
    var chart = anychart.pie();
    chart.data(data);
    // set the chart title
    chart.title("Group's extra hours stats");

    // set the container id
    chart.container("grafico2");

    // initiate drawing the chart
    chart.draw();
});

     </script>   
  <br>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <script type="text/javascript">
      function show(variabile) {
       if(document.getElementById(variabile).style.display=='') { 
        document.getElementById(variabile).style.display='none'; 
      }else{ 
        document.getElementById(variabile).style.display=''; 
      } 
      };
  </script>
  <script type="text/javascript">
      $(document).on('click', function (e) {
        if ($(e.target).closest("#box").length === 0 && $(e.target).closest("#ButtonGroupDelete").length === 0 ) {
          $("#box").hide();
        }
      });
  </script>

<!-- Index eventi 
<%= link_to "Events", group_events_path(@group) %>
-->
<div>

  <% if @group.git_repository.nil? || @group.git_repository== "422"%>
    <span><%= link_to "Create a github repository for the group", name_repository_path(@group), class:"btn btn btn-sm" %></span>
  <%else%>
    <%=link_to "Click to see OrganizeForUs's GitHub repositories", get_github_link_path(@group) , method: :get,class:"btn btn btn-sm"%>
    <!--a href="<%=@group.git_url%>", class:"btn btn btn-sm">Click to see OrganizeForUs's GitHub repositories</a-->
  <%end%>
</div>
  </body>
</html>
</br>
</br>